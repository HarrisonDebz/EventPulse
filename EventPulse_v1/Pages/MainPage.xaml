<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="EventPulse_v1.Pages.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:EventPulse_v1.ViewModels"
    BackgroundColor="{StaticResource DarkBackgroundColor}">

    <ContentPage.BindingContext>
        <vm:MainViewModel />
    </ContentPage.BindingContext>

    <Grid Padding="16" RowDefinitions="Auto,Auto,*,Auto">
        <!--  Header  -->
        <StackLayout
            Grid.Row="0"
            Orientation="Horizontal"
            Spacing="8">
            <Label Style="{StaticResource Headline}" Text="EventPulse" />
            <Label
                Style="{StaticResource SmallSecondary}"
                Text="Find campus events"
                VerticalOptions="Center" />
        </StackLayout>

        <!--  Search & Filter  -->
        <Grid Grid.Row="1" Margin="0,12,0,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Frame Grid.Column="0" Style="{StaticResource Card}">
                <Grid>
                    <Entry
                        BackgroundColor="Transparent"
                        Placeholder="Search events, clubs or venues"
                        PlaceholderColor="{StaticResource TextSecondary}"
                        Text="{Binding SearchQuery}" />
                </Grid>
            </Frame>

            <Button
                Grid.Column="1"
                Margin="8,0,0,0"
                Command="{Binding OpenFiltersCommand}"
                Style="{StaticResource PrimaryButton}"
                Text="Filters" />
        </Grid>

        <!--  Feed  -->
        <CollectionView
            Grid.Row="2"
            ItemsSource="{Binding Events}"
            SelectedItem="{Binding SelectedEvent, Mode=TwoWay}"
            SelectionMode="Single">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Style="{StaticResource Card}">
                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                            <StackLayout Grid.Column="0">
                                <Label
                                    FontAttributes="Bold"
                                    Text="{Binding Title}"
                                    TextColor="{StaticResource TextPrimary}" />
                                <Label
                                    LineBreakMode="TailTruncation"
                                    Text="{Binding ShortDescription}"
                                    TextColor="{StaticResource TextSecondary}" />
                                <Label
                                    FontSize="12"
                                    Text="{Binding WhenSummary}"
                                    TextColor="{StaticResource AccentMuted}" />
                            </StackLayout>

                            <StackLayout
                                Grid.Column="1"
                                HorizontalOptions="End"
                                Spacing="6"
                                VerticalOptions="Center">
                                <Button
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=RsvpCommand}"
                                    CommandParameter="{Binding .}"
                                    Style="{StaticResource PrimaryButton}"
                                    Text="RESPOND" />
                                <Label
                                    HorizontalTextAlignment="Center"
                                    Style="{StaticResource SmallSecondary}"
                                    Text="{Binding AttendeesCount, StringFormat='{0} going'}" />
                            </StackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!--  Floating action / create  -->
        <Button
            Grid.Row="3"
            Margin="0,12,0,0"
            Command="{Binding NavigateCreateCommand}"
            HorizontalOptions="End"
            Style="{StaticResource PrimaryButton}"
            Text="Create Event" />
    </Grid>
</ContentPage>